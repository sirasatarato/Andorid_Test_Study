# Test

## 좋은 테스트 조건
1. 읽기 쉬운 코드
2. 구조화가 잘된 코드
3. 독립적인 테스트
4. 절대 실패하거나 성공하지 않는 테스트가 아닌 테스트

## 테스트 더블
1. 테스트 대상 코드를 격리(독립적인 코드 유지)
2. 테스트 속도 개선
3. 예특 불가능한 실행요소 제거
4. 특수한 상황 시뮬레이션
5. 감추어진 정보 얻음
    - 테스트 대상 코드와 협력 객체 사이의 상호작용 확인

#### 종류
1. 스텁
    - 끝이 잘렸거나 유난히 짧은 것
    - 원래의 구현을 최대한 단순한 것으로 대체하는 것
    - void 메소드, 하드코딩된 값만 반환하는 메소드
2. 가짜 객체
    - 진짜 객체를 흉내낸 객체
    - 진짜 객체를 사용할 때 생기는 부수 효과나 연쇄 동작이 일어나지 않도록 경량화하고 최적화한 것
    - void 메소드, 객체를 반환하는 메소드에서 null을 반환하는 메소드 
3. 스파이
    - 입력 인자로 사용되는 객체가 테스트에 필요한 정보를 알여주는 API를 제공하지 않을 때 유용
4. Mock
    - 특수한 형태의 스파이
    - 특정 조건이 발생하면 미리 약속된 행동을 취함

#### 사용주의
1. 용도에 맞는 더블을 사용
    - Mock: 두 객체간 상호작용의 결과로 특정 메소드가 호출되었는지 확인
    - 스파이: Mock 객체를 사용하였는데 테스트 코드가 깔끔하지 않음
    - 스텁: 형력 객체가 대상 객체에 넘겨줄 응답도 테스트에서 통제 가능
    - 가짜 객체: 다수의 스텁을 사용하는데 시나리오가 너무 복잡해 관리가 어려움
    - 이도 저도 아니면 동전의 앞면은 Mock, 뒷면은 스텁, 6000분의 1은 가짜 객체
2. 준비, 시작, 단언(AAA, arrange-act-assert) 규칙 지키기

## 테스트 냄새
#### 가독성
1. 기본 타입 단언
    - 단언하려는 이유나 의도가 의미를 알 수 없는 단어나 숫자에 가려진 테스트
    - 의미가 담긴 변수에 매직 넘버를 담는다.
2. 부차적 상세정보
    - 핵심을 제외한 자잘한 코드 때문에 가독성이 떨어진 테스트
    - 셋업이나 메소드를 만들어서 분리한다.
    - 본질과 관련없는 세부내용을 삭제한다.
3. 다중인격
    - 여러 개의 테스트 목적을 한 메서드에 담은 테스트
    - 여러 개의 테스트 메서드로 쪼갠다.
4. 쪼개진 논리
    - 코드의 흐름이 이리저리 흩어진 테스트
    - 외부 코드를 테스트로 옮긴다.
5. 셋업 설교
    - 상당량의 코드를 셋업 메소드에 옮긴 테스트
    - 함수를 만들어서 분할한다.
6. 과잉보호 테스트
    - 객체가 null인지부터 확인하는 테스트
    - null인지 확인하는 단언은 굳이 있을 필요가 없으니 바로 삭제한다.
#### 유지보수
1. 중복
2. 조건부 로직
    - 조건문 때문에 제 기능을 못하는 테스트
    - 코드 간소화, 마지막에 fail문 추가
3. 양치기 테스트
    - 불규칙적으로 실패하거나 통과하는 테스트
    - 회피, 제어, 격리
4. 끈질긴 임시 파일
    - 임시로 쓰기 위해 만들어진 파일이 테스트 수행까지 지워지지 않고 버티는 파일
    - 파일을 스트림으로 대체
    - 테스트 목적 아닐시 테스트에서 쓰지 않는다.
    - @Before 메소드에서 파일 제거, 임시 파일명을 고유명으로 짓는다.
5. 잠자는 달팽이
    - 너무 느린 테스트
    - 스레드, timesleep에 의해 느려진다.
    - 테스트 규모를 줄이거나 따로 라이브러리(concurrent)를 사용해서 해결한다.
6. 파라미터화된 혼란
    - 파라미터화된 테스트 패턴을 과하게 사용하는 테스트
    - 파라미터화된 테스트는 데이터를 아주 조금씩 변경해가면 수차례 반복검사하는 기법
    - 쓰지 않거나 중복을 줄인다.
#### 신뢰성
1. 주석
    - 안쓸거면 보이는 즉시 삭제한다.
2. 절대 실패하지 않는 테스트
    - 예외가 발생하길 바라던 테스트에서 예외가 발생하지 않았을 시 fail문을 반드시 넣는다.
3. 지키지 못할 약속
    - 아무것도 않하는, 검증을 않하는, 이름값 못하는 테스트
    - 새로 다시 만든다.
4. 플랫폼 편견
    - 플랫폼에 다라 결과가 달라지는 테스트
    - 플랫폼 별로 테스트를 나눈다.
5. 조건부 테스트
    - 숨겨진 조건문 때문에 테스트 이름과 다르게 실행하는 테스트
    - 모든 분기에 단언(또는 실패조건)을 넣는다.